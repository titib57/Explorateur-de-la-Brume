<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistiques du personnage-Explorateur de la Brume</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <header class="game-header">
        <h1>Explorateur de la Brume</h1>
        <nav>
            <a href="index.html">Accueil</a>
            <a id="world-map-link" href="world_map.html">Carte du monde</a>
            <a href="skill_tree.html">Arbre de compétences</a>
            <a href="stats.html">Statistiques</a>
            <a href="inventory.html">Inventaire</a>
            <a href="quests.html">Quêtes</a>
        </nav>
    </header>

    <main class="game-container">
        <h2>Statistiques du personnage</h2>
        
        <div id="character-info">
            <p>Nom: <span id="char-name-display"></span></p>
            <p>Classe: <span id="char-class-display"></span></p>
            <p>Niveau: <span id="char-level-display"></span></p>
            <p>Âge: <span id="char-age-display"></span> ans</p>
            <p>Taille: <span id="char-height-display"></span> cm</p>
            <p>Poids: <span id="char-weight-display"></span> kg</p>
            <p>Expérience: <span id="char-xp-display"></span> / <span id="char-xp-to-next-level-display"></span></p>
            <p>Or: <span id="char-gold-display"></span></p>
        </div>

        <div id="base-stats">
            <h3>Statistiques de base</h3>
            <p>Points de statistiques disponibles: <span id="stat-points-display">0</span></p>
            <ul>
                <li>Force: <span id="strength-display"></span> <button data-stat="strength" data-action="add" class="btn-stat">+</button> <button data-stat="strength" data-action="minus" class="btn-stat">-</button></li>
                <li>Intelligence: <span id="intelligence-display"></span> <button data-stat="intelligence" data-action="add" class="btn-stat">+</button> <button data-stat="intelligence" data-action="minus" class="btn-stat">-</button></li>
                <li>Vitesse: <span id="speed-display"></span> <button data-stat="speed" data-action="add" class="btn-stat">+</button> <button data-stat="speed" data-action="minus" class="btn-stat">-</button></li>
                <li>Dextérité: <span id="dexterity-display"></span> <button data-stat="dexterity" data-action="add" class="btn-stat">+</button> <button data-stat="dexterity" data-action="minus" class="btn-stat">-</button></li>
            </ul>
        </div>
        
        <div id="derived-stats">
            <h3>Statistiques dérivées</h3>
            <p>PV Max: <span id="max-hp-display"></span></p>
            <p>Mana Max: <span id="max-mana-display"></span></p>
            <p>Dégâts d'attaque: <span id="attack-damage-display"></span></p>
            <p>Défense: <span id="defense-display"></span></p>
        </div>

        <button id="save-stats-btn" class="btn-primary">Sauvegarder les statistiques</button>
    </main>

    <div id="notification-container"></div>
    <script type="module" src="js/modules/character.js"></script>
    <script type="module" src="js/modules/ui.js"></script>
    <script type="module" src="js/core/state.js"></script>
    <script type="module">
        import { loadCharacter, saveCharacter, player, recalculateDerivedStats } from './js/core/state.js';
        import { updateStatsUI } from './js/modules/ui.js';
        
        document.addEventListener('DOMContentLoaded', () => {
            if (!loadCharacter()) {
                window.location.href = 'character_creation.html';
                return;
            }

            let stats = { ...player.stats };
            let statPoints = player.statPoints;
            const initialStats = { ...player.stats };
            
            function updateUI() {
                updateStatsUI(player, stats, statPoints);
                const tempPlayer = { ...player, stats: stats };
                recalculateDerivedStats(tempPlayer);
                document.getElementById('max-hp-display').textContent = tempPlayer.maxHp;
                document.getElementById('max-mana-display').textContent = tempPlayer.maxMana;
                document.getElementById('attack-damage-display').textContent = tempPlayer.attackDamage;
                document.getElementById('defense-display').textContent = tempPlayer.defense;
            }
            
            document.querySelectorAll('.btn-stat').forEach(button => {
                button.addEventListener('click', (event) => {
                    const stat = event.target.dataset.stat;
                    const action = event.target.dataset.action;
                    
                    if (action === 'add' && statPoints > 0) {
                        stats[stat]++;
                        statPoints--;
                    } else if (action === 'minus' && stats[stat] > initialStats[stat]) { 
                        stats[stat]--;
                        statPoints++;
                    }
                    updateUI();
                });
            });

            document.getElementById('save-stats-btn').addEventListener('click', () => {
                player.stats = stats;
                player.statPoints = statPoints;
                recalculateDerivedStats();
                saveCharacter(player);
                showNotification("Statistiques sauvegardées !", 'success');
                setTimeout(() => {
                    window.location.href = 'world_map.html';
                }, 2000);
            });

            updateUI();
        });
    </script>
</body>
</html>