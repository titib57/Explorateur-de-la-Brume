<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistiques du personnage-Explorateur de la Brume</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <header class="game-header">
        <h1>Explorateur de la Brume</h1>
        <nav>
            <a href="index.html">Accueil</a>
            <a id="world-map-link" href="world_map.html">Carte du monde</a>
            <a href="skill_tree.html">Arbre de compétences</a>
            <a href="stats.html">Statistiques</a>
            <a href="inventory.html">Inventaire</a>
            <a href="quests.html">Quêtes</a>
        </nav>
    </header>

    <main class="game-container">
        <h2>Statistiques</h2>
        
        <div id="playerCharacter">
            <p>Nom: <span id="char-name-display"></span></p>
            <p>Classe: <span id="char-class-display"></span></p>
            <p>Niveau: <span id="char-level-display"></span></p>
            <p>Âge: <span id="char-age-display"></span> ans</p>
            <p>Taille: <span id="char-height-display"></span> cm</p>
            <p>Poids: <span id="char-weight-display"></span> kg</p>
            <p>Points de stats restants: <span id="stat-points-display">0</span></p>
        </div>

        <div class="stats-container">
            <h3>Statistiques de base</h3>
            <div class="stat-group">
                <p>Force: <span id="strength-display">0</span></p>
                <button class="btn-stat" data-stat="strength" data-action="minus">-</button>
                <button class="btn-stat" data-stat="strength" data-action="add">+</button>
            </div>
            <div class="stat-group">
                <p>Intelligence: <span id="intelligence-display">0</span></p>
                <button class="btn-stat" data-stat="intelligence" data-action="minus">-</button>
                <button class="btn-stat" data-stat="intelligence" data-action="add">+</button>
            </div>
            <div class="stat-group">
                <p>Vitesse: <span id="speed-display">0</span></p>
                <button class="btn-stat" data-stat="speed" data-action="minus">-</button>
                <button class="btn-stat" data-stat="speed" data-action="add">+</button>
            </div>
            <div class="stat-group">
                <p>Dextérité: <span id="dexterity-display">0</span></p>
                <button class="btn-stat" data-stat="dexterity" data-action="minus">-</button>
                <button class="btn-stat" data-stat="dexterity" data-action="add">+</button>
            </div>
        </div>

        <div class="derived-stats-container">
            <h3>Statistiques dérivées</h3>
            <p>PV Max: <span id="max-hp-display">0</span></p>
            <p>Mana Max: <span id="max-mana-display">0</span></p>
            <p>Attaque: <span id="attack-damage-display">0</span></p>
            <p>Défense: <span id="defense-display">0</span></p>
        </div>

        <button id="save-stats-btn" class="btn btn-primary">Sauvegarder les statistiques</button>
    </main>

    <footer class="game-footer">
        <p>© 2025 Explorateur de la Brume. Tous droits réservés.</p>
    </footer>

    <script type="module">
        import { player, loadCharacter, savePlayer, recalculateDerivedStats } from './js/core/state.js';
        import { updateStatsUI } from './js/modules/ui.js';
        import { showNotification } from './js/core/notifications.js';
        
        document.addEventListener('DOMContentLoaded', () => {
            const currentPlayer = loadCharacter();
            let initialStats = {};

            if (currentPlayer) {
                // Stocke les statistiques initiales pour la réinitialisation
                initialStats = { ...currentPlayer.stats };
                
                // Met à jour l'UI avec les données du joueur chargé
                updatePlayerInfo(currentPlayer);
                updateStatsUI(currentPlayer);
            } else {
                // Si aucun personnage n'est trouvé, redirige vers la page de création.
                window.location.href = 'index.html'; 
            }

            // Met à jour l'UI avec les stats temporaires.
            function updateUI() {
                recalculateDerivedStats(currentPlayer);
                updateStatsUI(currentPlayer);
            }

            // Met à jour les informations de base du joueur.
            function updatePlayerInfo(p) {
                if (!p) return;
                // Utilise des valeurs par défaut si les données ne sont pas présentes
                document.getElementById('char-name-display').textContent = p.name || 'Inconnu';
                document.getElementById('char-class-display').textContent = p.playerClass || 'Inconnu';
                document.getElementById('char-level-display').textContent = p.level || 1;
                document.getElementById('char-age-display').textContent = p.age || 25;
                document.getElementById('char-height-display').textContent = p.height || 175;
                document.getElementById('char-weight-display').textContent = p.weight || 75;
            }
            
            document.querySelectorAll('.btn-stat').forEach(button => {
                button.addEventListener('click', (event) => {
                    const stat = event.target.dataset.stat;
                    const action = event.target.dataset.action;
                    
                    if (action === 'add' && currentPlayer.statPoints > 0) {
                        currentPlayer.stats[stat]++;
                        currentPlayer.statPoints--;
                    } else if (action === 'minus' && currentPlayer.stats[stat] > initialStats[stat]) { 
                        currentPlayer.stats[stat]--;
                        currentPlayer.statPoints++;
                    }
                    updateUI();
                });
            });

            document.getElementById('save-stats-btn').addEventListener('click', () => {
                if (currentPlayer) {
                    savePlayer(currentPlayer);
                    if (typeof showNotification === 'function') {
                        showNotification("Statistiques sauvegardées !", 'success');
                    }
                    setTimeout(() => {
                        window.location.href = 'world_map.html';
                    }, 2000);
                }
            });
           
        });
    </script>
</body>
</html>
